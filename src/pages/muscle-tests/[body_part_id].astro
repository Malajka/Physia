---
import PageHeader from "@/components/common/PageHeader.astro";
import MuscleTestForm from "@/components/muscle-test-selection/MuscleTestForm";
import EmptyState from "@/components/ui/EmptyState.astro";
import { ErrorAlert } from "@/components/ui/ErrorAlert";
import Layout from "@/layouts/Layout.astro";
import { getMuscleTestsPageData } from "@/lib/services/muscle-test-page-data";

export const prerender = false;

const { muscleTests, fetchError, pageTitle, bodyPartId, backLink } = await getMuscleTestsPageData(Number(Astro.params.body_part_id));
---

<Layout title={pageTitle}>
  <div class="container mx-auto py-8 px-2 sm:px-4">
    <PageHeader
      title={pageTitle}
      subtitle="Please rate the pain intensity for each test on a scale from 0 (no pain) to 10 (severe pain that prevents work)."
    />

    {
      fetchError ? (
        <ErrorAlert errors={fetchError} />
      ) : muscleTests && muscleTests.length > 0 ? (
        <MuscleTestForm client:load bodyPartId={bodyPartId} muscleTests={muscleTests} />
      ) : (
        <EmptyState message="No muscle tests available for this body part." {...backLink} label={backLink.text} />
      )
    }
  </div>
</Layout>
