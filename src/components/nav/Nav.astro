---
import { LogoutButton } from "@/components/auth/LogoutButton";
import { LinkButton } from "@/components/ui/LinkButton";

// Types
interface Props {
  isAuthenticated?: boolean;
}

// Extract props
const { isAuthenticated = false } = Astro.props as Props;

// Constants
const NAVIGATION_SECTIONS = ["about", "services", "benefits"] as const;
const AUTH_PAGES = ["/login", "/register"] as const;

// Helper functions
const getCurrentPath = () => Astro.url.pathname;
const isAuthPage = () => AUTH_PAGES.includes(getCurrentPath() as (typeof AUTH_PAGES)[number]);
const capitalizeFirst = (str: string) => str.charAt(0).toUpperCase() + str.slice(1);

// Computed values
const showAuthButtons = !isAuthenticated && !isAuthPage();
const showUserButtons = isAuthenticated;
---

<nav class="flex items-center w-full z-[9]" role="navigation" aria-label="Main navigation">
  <!-- Desktop Navigation -->
  <ul class="hidden lg:flex flex-1 justify-center items-center space-x-6" role="menubar">
    {
      NAVIGATION_SECTIONS.map((section) => (
        <li>
          <LinkButton href={`/#${section}`} variant="nav-link">
            {capitalizeFirst(section)}
          </LinkButton>
        </li>
      ))
    }
  </ul>

  <!-- Mobile Navigation -->
  <details class="lg:hidden ml-auto relative" role="group">
    <summary
      class="list-none p-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-[var(--primary)] rounded-lg"
      aria-label="Toggle navigation menu"
      role="button"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6 text-[var(--primary)]"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
        aria-hidden="true"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </summary>

    <ul class="absolute right-0 mt-2 w-48 bg-[var(--card)] p-4 shadow-md space-y-2 text-right border border-[var(--border)]" role="menu">
      {
        NAVIGATION_SECTIONS.map((section) => (
          <li>
            <LinkButton href={`/#${section}`} variant="nav-link" class="block">
              {capitalizeFirst(section)}
            </LinkButton>
          </li>
        ))
      }

      {
        showAuthButtons && (
          <>
            <li>
              <LinkButton href="/login" variant="nav-primary" class="block w-full">
                Log in
              </LinkButton>
            </li>
            <li>
              <LinkButton href="/register" variant="nav-secondary" class="block w-full">
                Register
              </LinkButton>
            </li>
          </>
        )
      }

      {
        showUserButtons && (
          <>
            <li>
              <LinkButton href="/sessions" variant="nav-link" class="block">
                My Sessions
              </LinkButton>
            </li>
            <li>
              <LinkButton href="/body-parts" variant="nav-link" class="block" data-testid="create-new-session-mobile">
                Create New Session
              </LinkButton>
            </li>
            <li>
              <LogoutButton
                client:load
                class="block w-full bg-transparent border border-[var(--gray-text)] text-[var(--gray-text)] hover:bg-[var(--light-green)] font-bold px-6 rounded-xl transition-colors"
              />
            </li>
          </>
        )
      }
    </ul>
  </details>

  <!-- Desktop Auth/User Buttons -->
  <ul class="hidden lg:flex items-center space-x-6">
    {
      showAuthButtons && (
        <>
          <li>
            <LinkButton href="/login" variant="nav-primary">
              Log in
            </LinkButton>
          </li>
          <li>
            <LinkButton href="/register" variant="nav-secondary">
              Register
            </LinkButton>
          </li>
        </>
      )
    }

    {
      showUserButtons && (
        <>
          <li>
            <LinkButton href="/sessions" variant="nav-link" class="block">
              My Sessions
            </LinkButton>
          </li>
          <li>
            <LinkButton href="/body-parts" variant="nav-link" class="block" data-testid="create-new-session-desktop">
              Create New Session
            </LinkButton>
          </li>
          <li>
            <LogoutButton
              client:load
              class="bg-transparent border border-[var(--gray-text)] text-[var(--gray-text)] hover:bg-[var(--light-green)] font-bold px-6 rounded-xl transition-colors"
            />
          </li>
        </>
      )
    }
  </ul>
</nav>
